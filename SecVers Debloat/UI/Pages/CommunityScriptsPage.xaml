<Page x:Class="SecVers_Debloat.UI.Pages.CommunityScriptsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:SecVers_Debloat.UI.Pages"
      xmlns:ui="http://schemas.inkore.net/lib/ui/wpf/modern"
      xmlns:ikw="http://schemas.inkore.net/lib/ui/wpf"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="CommunityScriptsPage">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24">

            <!-- ==================== HEADER ==================== -->
            <StackPanel Margin="0,0,0,24">
                <TextBlock 
                    Text="Scripts Library" 
                    FontSize="28" 
                    FontWeight="SemiBold"
                    Margin="0,0,0,8"/>
                <TextBlock 
                    Text="Manage PowerShell (.ps1) and JavaScript (.js) automations."
                    FontSize="14"
                    Opacity="0.7"
                    TextWrapping="Wrap"/>
            </StackPanel>

            <!-- ==================== STATUS ==================== -->
            <TextBlock 
                x:Name="StatusTextBlock"
                Visibility="Collapsed"
                Margin="0,0,0,16"
                FontWeight="SemiBold"/>

            <!-- ==================== LOCAL FILE IMPORT ==================== -->
            <ui:SettingsCard 
                Header="Import Local File"
                Description="Import .ps1 or .js files from your computer"
                HeaderIcon="{x:Static ui:SegoeFluentIcons.OpenFile}"
                Margin="0,0,0,16">
                <Button 
                    Content="Browse..."
                    Click="BrowseLocalButton_Click"
                    DockPanel.Dock="Right"
                    Padding="16,8"/>
            </ui:SettingsCard>

            <!-- ==================== ADD SCRIPT FROM URL ==================== -->
            <ui:SettingsCard 
                Header="Add Script from URL"
                Description="Paste a URL to a .ps1 or .js raw file"
                HeaderIcon="{x:Static ui:SegoeFluentIcons.Link}"
                Margin="0,0,0,16">
                <StackPanel>
                    <DockPanel Margin="0,8,0,0">
                        <Button 
                            x:Name="AddScriptButton"
                            Content="Add URL"
                            DockPanel.Dock="Right"
                            Margin="8,0,0,0"
                            Padding="16,8"
                            Click="AddScriptButton_Click"/>
                        <TextBox 
                            x:Name="UrlInputBox"
                            ui:ControlHelper.PlaceholderText="https://example.com/script.js"
                            Height="32"
                            Width="250"
                            VerticalContentAlignment="Center"/>
                    </DockPanel>
                </StackPanel>
            </ui:SettingsCard>

            <!-- ==================== IMPORT FROM JSON ==================== -->
            <ui:SettingsCard 
                Header="Import from JSON Library"
                Description="Load repository from a JSON URL"
                HeaderIcon="{x:Static ui:SegoeFluentIcons.CloudDownload}"
                Margin="0,0,0,16">
                <StackPanel>
                    <DockPanel Margin="0,8,0,0">
                        <Button 
                            x:Name="AddFromJsonButton"
                            Content="Import JSON"
                            DockPanel.Dock="Right"
                            Margin="8,0,0,0"
                            Padding="16,8"
                            Click="AddFromJsonButton_Click"/>
                        <TextBox 
                            x:Name="JsonUrlInputBox"
                            ui:ControlHelper.PlaceholderText="https://example.com/repo.json"
                            Height="32"
                            Width="250"
                            VerticalContentAlignment="Center"/>
                    </DockPanel>
                </StackPanel>
            </ui:SettingsCard>

            <!-- ==================== SCRIPTS LIST ==================== -->
            <TextBlock 
                Text="Your Scripts"
                FontSize="20"
                FontWeight="SemiBold"
                Margin="0,16,0,12"/>

            <!-- Empty State -->
            <Border 
                x:Name="EmptyStatePanel"
                BorderThickness="1"
                CornerRadius="8"
                Padding="32"
                Visibility="Visible">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock 
                        Text="📜" 
                        FontSize="48" 
                        HorizontalAlignment="Center"
                        Margin="0,0,0,16"/>
                    <TextBlock 
                        Text="No scripts yet"
                        FontSize="18"
                        FontWeight="SemiBold"
                        HorizontalAlignment="Center"
                        Margin="0,0,0,8"/>
                    <TextBlock 
                        Text="Import a local file or add from URL"
                        Opacity="0.7"
                        HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>

            <!-- Scripts ListView -->
            <ItemsControl  
                x:Name="ScriptsListView"
                Visibility="Collapsed"
                BorderThickness="0"
                Background="Transparent"
                ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                HorizontalContentAlignment="Stretch">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <ui:SettingsCard Width="Auto" Margin="0,0,0,4">
                                <ui:SettingsCard.Header>
                                    <StackPanel>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock 
                                                Text="{Binding Title}" 
                                                FontSize="16"
                                                FontWeight="SemiBold"/>
                                            <!-- Type Badge -->
                                            <Border Background="#20FFFFFF" CornerRadius="4" Margin="8,0,0,0" Padding="6,2">
                                                <TextBlock Text="{Binding Extension}" FontSize="10" Opacity="0.8"/>
                                            </Border>
                                        </StackPanel>

                                        <TextBlock 
                                            Text="{Binding Url}" 
                                            FontSize="12"
                                            Opacity="0.7"
                                            TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                </ui:SettingsCard.Header>

                                <StackPanel Orientation="Horizontal">
                                    <!-- Download Button (Only for URL) -->
                                    <Button 
                                        Content="Download"
                                        Padding="12,6"
                                        Margin="0,0,8,0"
                                        Click="DownloadButton_Click"
                                        Tag="{Binding}">
                                        <Button.Style>
                                            <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                                <Setter Property="Visibility" Value="Visible"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Downloaded}" Value="True">
                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <!-- Run Button -->
                                    <Button 
                                        Content="Run"
                                        Padding="12,6"
                                        Margin="0,0,8,0"
                                        Click="RunButton_Click"
                                        Tag="{Binding}">
                                        <Button.Style>
                                            <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Downloaded}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <!-- View Button -->
                                    <Button 
                                        Content="Edit/View"
                                        Padding="12,6"
                                        Margin="0,0,8,0"
                                        Click="ViewButton_Click"
                                        Tag="{Binding}">
                                        <Button.Style>
                                            <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Downloaded}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>

                                    <!-- Delete Button -->
                                    <Button 
                                        Content="Delete"
                                        Padding="12,6"
                                        Click="DeleteButton_Click"
                                        Tag="{Binding}"/>
                                </StackPanel>
                            </ui:SettingsCard>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
    </ScrollViewer>
</Page>
